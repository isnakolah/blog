@page "/create-article"

@using Common.Application.Articles.Commands.DTOs
@using Common.Application.Articles.Commands.Create

@inject NavigationManager _navigationManager;

<div class="mt-4 mx-auto w-full max-w-lg">
    <div class="bg-white py-8 px-6 shadow rounded-lg sm:px-10">
        <form onsubmit="@CreateArticle" class="mb-0 space-y-6" method="post">
            <div>
                <label for="title" class="block text-sm font-medium text-gray-500">
                    Article Title
                </label>
                <div class="mt-1">
                    <input @bind="@article.Title" id="title" name="title" type="text" required/>
                </div>
            </div>

            <div>
                <label for="excerpt" class="block text-sm font-medium text-gray-700">
                    Excerpt
                </label>
                <div class="mt-1">
                    <textarea @bind="@article.Excerpt" id="excerpt" name="excerpt" required></textarea>
                </div>
            </div>

            <div>
                <label for="content" class="block text-sm font-medium text-gray-700">
                    Content
                </label>
                <div class="mt-1">
                    <textarea @bind="@article.Content" id="content" name="content" required></textarea>
                </div>
            </div>

            <div class="mt-1">
                <select name="company-size" id="company-size">
                    <option value="">Please select</option>
                    <option value="small">1 to 10 employees</option>
                    <option value="medium">11 to 50</option>
                    <option value="large">50+ employees</option>
                </select>
            </div>

            <div>
                <label for="cover-photo" class="block text-sm font-medium text-gray-700">Cover Image</label>
                <div class="mt-1">
                    <input @bind="@article.FeaturedImageUri" type="file" id="cover-photo" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100" tabindex="-1"/>
                </div>
            </div>

            <div class="flex items-center">
                <input id="terms-and-privacy" name="terms-and-privacy" type="checkbox"/>
                <label for="terms-and-privacy" class="pl-2 block text-sm text-gray-900">I agree to the <a href="#" class="text-indigo-600 hover:text-indigo-500">Terms</a> and <a href="#" class="text-indigo-600 hover:text-indigo-500">Privacy Policy</a></label>
            </div>

            <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Create
            </button>
        </form>
    </div>
</div>

@code {
    private (string Title, string Content, string Excerpt, string FeaturedImageUri) article;

    private async Task CreateArticle()
    {
        var (title, content, excerpt, featuredImageUri) = article;

        var createdArticle = new CreateArticleCommand(new ArticleCreateDTO(title, content, excerpt, Guid.Empty, DateTime.Now, featuredImageUri));

        await Mediator.Send(createdArticle);

        _navigationManager.NavigateTo("");
    }

}